<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRZ Timer - Ultimate Study Timer</title>
    <!-- Add html2canvas and jsPDF libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, 
                #1a1c23 0%, 
                #232630 50%, 
                #1a1c23 100%);
            overflow-x: hidden;
            position: relative;
        }

        /* Add this new blog link styling */
        .blog-link {
            position: fixed;
            top: 25px;
            right: 25px;
            z-index: 100;
            background: linear-gradient(135deg, 
                #38d9a9 0%, 
                #26b795 100%);
            backdrop-filter: blur(20px);
            padding: 10px 20px;
            border-radius: 16px;
            font-weight: 700;
            font-size: 1rem;
            color: #0f172a;
            text-decoration: none;
            text-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            box-shadow: 
                0 6px 24px rgba(56, 217, 169, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            letter-spacing: 0.3px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .blog-link:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 
                0 12px 32px rgba(56, 217, 169, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
            color: #0f172a;
            text-decoration: none;
        }

        .blog-link:active {
            transform: translateY(-1px) scale(1.02);
        }

        .blog-icon {
            font-size: 1.2rem;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(119, 198, 255, 0.1) 0%, transparent 50%);
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: float 15s infinite linear;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        @keyframes float {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }

        .alarm-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(15px) brightness(0.8);
        }

        .alarm-overlay.red {
            background: linear-gradient(135deg, 
                rgba(255, 87, 110, 0.95) 0%, 
                rgba(255, 68, 102, 0.95) 100%);
            animation: pulseAlarm 0.8s infinite alternate;
        }

        .alarm-overlay.green {
            background: linear-gradient(135deg, 
                rgba(56, 217, 169, 0.95) 0%, 
                rgba(42, 197, 155, 0.95) 100%);
        }

        .alarm-overlay.question {
            background: linear-gradient(135deg, 
                rgba(129, 140, 248, 0.95) 0%, 
                rgba(105, 118, 242, 0.95) 100%);
        }

        .alarm-overlay.break {
            background: linear-gradient(135deg, 
                rgba(251, 191, 36, 0.95) 0%, 
                rgba(245, 158, 11, 0.95) 100%);
        }

        @keyframes pulseAlarm {
            0% { opacity: 0.95; transform: scale(1); }
            100% { opacity: 0.8; transform: scale(1.02); }
        }

        .alarm-content {
            text-align: center;
            color: white;
            padding: 3rem;
            max-width: 600px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .alarm-content h1 {
            font-size: clamp(2rem, 5vw, 3.5rem);
            margin-bottom: 2rem;
            font-weight: 800;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            letter-spacing: -0.5px;
        }

        .alarm-buttons {
            display: flex;
            gap: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .alarm-btn {
            padding: 1.2rem 2.5rem;
            font-size: 1.1rem;
            font-weight: 700;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .alarm-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            transition: 0.5s;
        }

        .alarm-btn:hover::before {
            left: 100%;
        }

        .alarm-btn:hover {
            transform: translateY(-4px);
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .start-btn {
            background: linear-gradient(135deg, 
                #38d9a9 0%, 
                #26b795 100%);
            color: #0f172a;
        }

        .snooze-btn {
            background: linear-gradient(135deg, 
                #fbbf24 0%, 
                #f59e0b 100%);
            color: #0f172a;
        }

        .yes-btn {
            background: linear-gradient(135deg, 
                #818cf8 0%, 
                #6976f2 100%);
            color: white;
        }

        .no-btn {
            background: linear-gradient(135deg, 
                #ff6b8b 0%, 
                #ff4466 100%);
            color: white;
        }

        .break-btn {
            background: linear-gradient(135deg, 
                #fbbf24 0%, 
                #f59e0b 100%);
            color: #0f172a;
        }

        .extend-input {
            display: none;
            margin-top: 1.5rem;
            animation: slideUp 0.3s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .extend-input input {
            padding: 1rem 1.5rem;
            font-size: 1.2rem;
            border-radius: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            width: 180px;
            text-align: center;
            margin-right: 1rem;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        .extend-input input:focus {
            outline: none;
            border-color: #38d9a9;
            box-shadow: 0 0 20px rgba(56, 217, 169, 0.3);
        }

        .extend-input input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .logo {
            position: fixed;
            top: 25px;
            left: 25px;
            z-index: 100;
            background: linear-gradient(135deg, 
                #818cf8 0%, 
                #6976f2 100%);
            backdrop-filter: blur(20px);
            padding: 12px 24px;
            border-radius: 18px;
            font-weight: 800;
            font-size: 1.6rem;
            color: white;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            box-shadow: 
                0 8px 32px rgba(129, 140, 248, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            letter-spacing: 1px;
            transition: transform 0.3s;
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .watermark {
            position: fixed;
            bottom: 10%;
            right: 5%;
            font-size: clamp(2rem, 8vw, 6rem);
            font-weight: 900;
            color: rgba(255, 255, 255, 0.03);
            transform: rotate(-15deg);
            pointer-events: none;
            z-index: 2;
            animation: floatWatermark 8s ease-in-out infinite;
            user-select: none;
            font-family: 'SF Pro Display', -apple-system, sans-serif;
            letter-spacing: 2px;
        }

        @keyframes floatWatermark {
            0%, 100% { transform: rotate(-15deg) translateY(0) translateX(0); }
            25% { transform: rotate(-15deg) translateY(-20px) translateX(10px); }
            75% { transform: rotate(-15deg) translateY(10px) translateX(-10px); }
        }

        .container {
            position: relative;
            z-index: 10;
            max-width: 1400px;
            margin: 0 auto;
            padding: 3rem 2rem;
        }

        .warning-light {
            position: fixed;
            top: 25px;
            right: 80px; /* Adjusted to make room for blog link */
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: linear-gradient(135deg, 
                #ff6b8b 0%, 
                #ff4466 100%);
            display: none;
            animation: pulseWarning 0.8s infinite alternate;
            z-index: 100;
            box-shadow: 
                0 0 30px rgba(255, 68, 102, 0.8),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .warning-light.active {
            display: block;
        }

        @keyframes pulseWarning {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.3); opacity: 0.8; }
        }

        .clock-section {
            text-align: center;
            margin-bottom: 4rem;
            position: relative;
        }

        .clock-section::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 80%;
            background: radial-gradient(circle, 
                rgba(129, 140, 248, 0.1) 0%, 
                transparent 70%);
            filter: blur(40px);
            z-index: -1;
        }

        .giant-clock {
            font-size: clamp(4rem, 18vw, 18rem);
            font-weight: 900;
            background: linear-gradient(135deg, 
                #818cf8 0%, 
                #38d9a9 50%, 
                #818cf8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.1;
            min-height: 35vh;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            text-shadow: 
                0 0 80px rgba(129, 140, 248, 0.5),
                0 0 120px rgba(56, 217, 169, 0.3);
            position: relative;
            padding: 2rem;
            letter-spacing: -2px;
            font-family: 'SF Pro Display', -apple-system, sans-serif;
        }

        .clock-container {
            display: flex;
            align-items: baseline;
            justify-content: center;
            gap: 0.2em;
            flex-wrap: wrap;
        }

        .clock-buzz {
            animation: buzzClock 0.1s infinite;
        }

        @keyframes buzzClock {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-3px) rotate(-0.5deg); }
            75% { transform: translateX(3px) rotate(0.5deg); }
        }

        .ampm {
            font-size: 0.25em;
            margin-left: 0.1em;
            vertical-align: super;
            opacity: 0.7;
            font-weight: 600;
        }

        .mode-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 3rem;
            justify-content: center;
            flex-wrap: wrap;
            position: relative;
        }

        .mode-tabs::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent);
            z-index: -1;
        }

        .mode-tab {
            padding: 1.2rem 2.4rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 18px;
            color: rgba(255, 255, 255, 0.7);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
            font-size: 1.1rem;
            letter-spacing: 0.3px;
        }

        .mode-tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.1), 
                transparent);
            transition: 0.5s;
        }

        .mode-tab:hover::before {
            left: 100%;
        }

        .mode-tab:hover {
            color: white;
            border-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .mode-tab.active {
            background: linear-gradient(135deg, 
                #818cf8 0%, 
                #6976f2 100%);
            color: white;
            border-color: transparent;
            transform: translateY(-3px);
            box-shadow: 
                0 15px 40px rgba(129, 140, 248, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .mode-content {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .mode-content.active {
            display: block;
        }

        .main-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 2.5rem;
            margin-top: 2rem;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .logo {
                font-size: 1.3rem;
                padding: 10px 20px;
                top: 20px;
                left: 20px;
            }
            
            .blog-link {
                top: 20px;
                right: 20px;
                font-size: 0.9rem;
                padding: 8px 16px;
            }
            
            .warning-light {
                top: 20px;
                right: 70px;
            }
            
            .giant-clock {
                font-size: clamp(3rem, 15vw, 7rem);
                min-height: 25vh;
                letter-spacing: -1px;
            }
            
            .card {
                padding: 2rem;
            }
            
            .alarm-content {
                padding: 2rem;
                margin: 1rem;
            }
            
            .alarm-content h1 {
                font-size: clamp(1.5rem, 4vw, 2.5rem);
            }
            
            .alarm-btn {
                padding: 1rem 2rem;
                font-size: 1rem;
            }

            .mode-tab {
                padding: 1rem 2rem;
                font-size: 1rem;
            }
            
            .subject-block {
                padding: 1.5rem;
            }
            
            .container {
                padding: 2rem 1.5rem;
            }
            
            .clock-section {
                margin-bottom: 3rem;
            }
        }

        @media (max-width: 480px) {
            .alarm-buttons {
                flex-direction: column;
                gap: 1rem;
            }
            
            .alarm-btn {
                width: 100%;
            }
            
            .extend-input input {
                width: 100%;
                margin-right: 0;
                margin-bottom: 1rem;
            }
            
            .blog-link {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
            
            .logo {
                font-size: 1.1rem;
                padding: 8px 16px;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 28px;
            padding: 3rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: transform 0.4s, box-shadow 0.4s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        .card-title {
            font-size: 2.2rem;
            font-weight: 800;
            color: white;
            margin-bottom: 2rem;
            text-align: center;
            letter-spacing: -0.5px;
            background: linear-gradient(135deg, 
                #818cf8 0%, 
                #38d9a9 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 20px rgba(129, 140, 248, 0.2);
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-group label {
            display: block;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 0.8rem;
            font-weight: 600;
            font-size: 1.1rem;
            letter-spacing: 0.3px;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 1rem 1.5rem;
            border-radius: 14px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.07);
            color: white;
            font-size: 1.1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            font-family: 'Inter', sans-serif;
        }

        .input-group input::placeholder {
            color: rgba(255, 255, 255, 0.4);
        }

        .input-group select option {
            background: #232630;
            color: white;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #818cf8;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 0 30px rgba(129, 140, 248, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .time-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .btn {
            padding: 1.2rem 2rem;
            border: none;
            border-radius: 14px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255, 255, 255, 0.2), 
                transparent);
            transition: 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 
                0 15px 40px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, 
                #818cf8 0%, 
                #6976f2 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, 
                #ff6b8b 0%, 
                #ff4466 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, 
                #38d9a9 0%, 
                #26b795 100%);
            color: #0f172a;
        }

        .btn-warning {
            background: linear-gradient(135deg, 
                #fbbf24 0%, 
                #f59e0b 100%);
            color: #0f172a;
        }

        .btn-full {
            width: 100%;
        }

        .schedule-list {
            margin-top: 2rem;
            max-height: 400px;
            overflow-y: auto;
            padding-right: 5px;
        }

        .schedule-list::-webkit-scrollbar {
            width: 6px;
        }

        .schedule-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .schedule-list::-webkit-scrollbar-thumb {
            background: rgba(129, 140, 248, 0.5);
            border-radius: 10px;
        }

        .schedule-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.2rem 1.5rem;
            border-radius: 14px;
            margin-bottom: 0.8rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .schedule-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .schedule-item.active {
            background: rgba(56, 217, 169, 0.2);
            border: 2px solid #38d9a9;
            box-shadow: 0 10px 30px rgba(56, 217, 169, 0.2);
        }

        .schedule-item.completed {
            background: rgba(255, 255, 255, 0.03);
            color: rgba(255, 255, 255, 0.5);
            border-color: rgba(255, 255, 255, 0.05);
            text-decoration: line-through;
        }

        .schedule-item.break {
            background: rgba(251, 191, 36, 0.2);
            border: 2px solid #fbbf24;
            color: #fbbf24;
            box-shadow: 0 10px 30px rgba(251, 191, 36, 0.2);
        }

        .delete-btn {
            background: linear-gradient(135deg, 
                #ff6b8b 0%, 
                #ff4466 100%);
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
        }

        .delete-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(255, 68, 102, 0.3);
        }

        .pomo-display {
            font-size: clamp(3rem, 8vw, 5rem);
            font-weight: 800;
            color: white;
            text-align: center;
            margin: 2.5rem 0;
            text-shadow: 
                0 0 40px rgba(129, 140, 248, 0.5),
                0 0 60px rgba(56, 217, 169, 0.3);
            letter-spacing: 2px;
            font-family: 'SF Pro Display', -apple-system, sans-serif;
        }

        .pomo-inputs {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .pomo-input {
            text-align: center;
        }

        .pomo-input label {
            display: block;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 0.8rem;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .pomo-input input {
            width: 100%;
            padding: 1rem;
            text-align: center;
            font-size: 1.8rem;
            font-weight: 700;
            border-radius: 14px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.07);
            color: white;
            transition: all 0.3s;
            font-family: 'SF Pro Display', -apple-system, sans-serif;
        }

        .pomo-input input:focus {
            outline: none;
            border-color: #818cf8;
            box-shadow: 0 0 30px rgba(129, 140, 248, 0.2);
        }

        .report-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 2.5rem;
            border-radius: 24px;
            margin-top: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            backdrop-filter: blur(20px);
        }

        .report-item {
            background: rgba(129, 140, 248, 0.1);
            padding: 1.2rem;
            border-radius: 14px;
            margin-bottom: 0.8rem;
            color: white;
            display: flex;
            justify-content: space-between;
            border: 1px solid rgba(129, 140, 248, 0.2);
            transition: all 0.3s;
        }

        .report-item:hover {
            background: rgba(129, 140, 248, 0.15);
            transform: translateX(5px);
        }

        .report-total {
            font-size: 1.8rem;
            font-weight: 800;
            color: #818cf8;
            text-align: center;
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(129, 140, 248, 0.1);
            border-radius: 18px;
            border: 1px solid rgba(129, 140, 248, 0.2);
            backdrop-filter: blur(10px);
            text-shadow: 0 4px 20px rgba(129, 140, 248, 0.3);
        }

        .subject-block {
            background: rgba(129, 140, 248, 0.08);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(129, 140, 248, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        .subject-block:hover {
            background: rgba(129, 140, 248, 0.12);
            transform: translateY(-3px);
            box-shadow: 0 20px 40px rgba(129, 140, 248, 0.1);
        }

        .subject-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            color: white;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(129, 140, 248, 0.3);
        }

        .subject-header h3 {
            font-size: 1.6rem;
            font-weight: 700;
            background: linear-gradient(135deg, 
                #818cf8 0%, 
                #38d9a9 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .remove-subject {
            background: linear-gradient(135deg, 
                #ff6b8b 0%, 
                #ff4466 100%);
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .remove-subject:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(255, 68, 102, 0.3);
        }

        .chapter-row {
            display: grid;
            grid-template-columns: 2fr 1fr auto;
            gap: 1rem;
            margin-bottom: 1rem;
            align-items: center;
        }

        .chapter-row input {
            padding: 0.8rem;
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.07);
            color: white;
            transition: all 0.3s;
        }

        .chapter-row input:focus {
            outline: none;
            border-color: #818cf8;
            background: rgba(255, 255, 255, 0.1);
        }

        .remove-chapter {
            background: linear-gradient(135deg, 
                #ff6b8b 0%, 
                #ff4466 100%);
            color: white;
            border: none;
            padding: 0.6rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .remove-chapter:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 20px rgba(255, 68, 102, 0.3);
        }

        .report-download-btn {
            display: block;
            margin: 3rem auto 0;
            padding: 1.2rem 3.5rem;
            font-size: 1.2rem;
            background: linear-gradient(135deg, 
                #38d9a9 0%, 
                #26b795 100%);
            color: #0f172a;
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 15px 40px rgba(56, 217, 169, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .report-download-btn:hover {
            transform: translateY(-4px);
            box-shadow: 
                0 25px 60px rgba(56, 217, 169, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .report-header {
            text-align: center;
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 3px solid rgba(129, 140, 248, 0.5);
        }

        .report-header h2 {
            color: #818cf8;
            font-size: 2.5rem;
            margin-bottom: 0.8rem;
            font-weight: 800;
            letter-spacing: -0.5px;
            text-shadow: 0 4px 20px rgba(129, 140, 248, 0.3);
        }

        .report-header .subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.1rem;
            letter-spacing: 0.3px;
        }

        .session-details {
            background: rgba(129, 140, 248, 0.08);
            padding: 1.5rem;
            border-radius: 18px;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(129, 140, 248, 0.2);
            transition: all 0.3s;
        }

        .session-details:hover {
            background: rgba(129, 140, 248, 0.12);
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(129, 140, 248, 0.1);
        }

        .session-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.2rem;
            margin-bottom: 1rem;
        }

        .info-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-label {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .info-value {
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .break-info {
            background: rgba(251, 191, 36, 0.15);
            padding: 0.8rem 1rem;
            border-radius: 10px;
            margin-top: 1rem;
            color: #fbbf24;
            font-weight: 700;
            border: 1px solid rgba(251, 191, 36, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .extra-time {
            background: rgba(255, 68, 102, 0.15);
            padding: 0.8rem 1rem;
            border-radius: 10px;
            margin-top: 1rem;
            color: #ff4466;
            font-weight: 700;
            border: 1px solid rgba(255, 68, 102, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .report-footer {
            text-align: center;
            margin-top: 2.5rem;
            padding-top: 1.5rem;
            border-top: 3px solid rgba(129, 140, 248, 0.5);
            color: #818cf8;
            font-size: 1.3rem;
            font-weight: 800;
            letter-spacing: 0.5px;
            text-shadow: 0 4px 20px rgba(129, 140, 248, 0.2);
        }

        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, 
                #818cf8 0%, 
                #38d9a9 100%);
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, 
                #6976f2 0%, 
                #26b795 100%);
        }

        /* Add floating particles animation */
        @keyframes particleFloat {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }

        /* Add glow effects for interactive elements */
        .btn-primary:hover,
        .alarm-btn.start-btn:hover,
        .alarm-btn.yes-btn:hover {
            box-shadow: 
                0 20px 50px rgba(129, 140, 248, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-success:hover,
        .alarm-btn.start-btn:hover {
            box-shadow: 
                0 20px 50px rgba(56, 217, 169, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-warning:hover,
        .alarm-btn.snooze-btn:hover,
        .alarm-btn.break-btn:hover {
            box-shadow: 
                0 20px 50px rgba(251, 191, 36, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .btn-danger:hover,
        .alarm-btn.no-btn:hover {
            box-shadow: 
                0 20px 50px rgba(255, 68, 102, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        /* Add some subtle animations for cards */
        @keyframes cardEnter {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .card {
            animation: cardEnter 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Gradient text utility */
        .gradient-text {
            background: linear-gradient(135deg, 
                #818cf8 0%, 
                #38d9a9 50%, 
                #fbbf24 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Loading animation */
        .loading-dots {
            display: inline-flex;
            gap: 4px;
        }

        .loading-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #818cf8;
            animation: loadingDot 1.4s infinite;
        }

        .loading-dots span:nth-child(2) { animation-delay: 0.2s; }
        .loading-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes loadingDot {
            0%, 60%, 100% { transform: translateY(0); opacity: 1; }
            30% { transform: translateY(-10px); opacity: 0.5; }
        }

        /* Selection color */
        ::selection {
            background: rgba(129, 140, 248, 0.3);
            color: white;
        }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>
    <div class="logo">FRZ</div>
    <a href="https://frz-notes.blogspot.com" target="_blank" class="blog-link">
        <span class="blog-icon">üìö</span>
        <span>FRZ Notes Blog</span>
    </a>
    <div class="warning-light" id="warningLight"></div>
    <div class="watermark">FRZ TIMER</div>

    <div class="alarm-overlay" id="alarmOverlay">
        <div class="alarm-content">
            <h1 id="alarmMessage"></h1>
            <div class="alarm-buttons" id="alarmButtons"></div>
            <div class="extend-input" id="extendInput">
                <input type="number" id="extendMinutes" placeholder="Minutes" min="1">
                <button class="alarm-btn start-btn" onclick="confirmExtend()">CONFIRM</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="clock-section">
            <div class="giant-clock" id="giantClock">
                <div class="clock-container">
                    <span id="clockTime">12:00:00</span>
                    <span class="ampm" id="clockAMPM">PM</span>
                </div>
            </div>
        </div>

        <div class="mode-tabs">
            <div class="mode-tab active" onclick="switchMode('manual')">üìÖ Manual Mode</div>
            <div class="mode-tab" onclick="switchMode('auto')">ü§ñ Auto Mode</div>
            <div class="mode-tab" onclick="switchMode('pomo')">‚è±Ô∏è Pomodoro</div>
            <div class="mode-tab" onclick="switchMode('report')">üìä Report</div>
        </div>

        <!-- MANUAL MODE -->
        <div class="mode-content active" id="manualMode">
            <div class="main-grid">
                <div class="card">
                    <h2 class="card-title">‚è∞ Manual Alarm System</h2>
                    <div class="input-group">
                        <label>Subject Name</label>
                        <input type="text" id="subjectName" placeholder="e.g., Physics">
                    </div>
                    <div class="time-inputs">
                        <div class="input-group">
                            <label>Start Time</label>
                            <input type="time" id="startTime">
                        </div>
                        <div class="input-group">
                            <label>End Time</label>
                            <input type="time" id="endTime">
                        </div>
                    </div>
                    <button class="btn btn-primary btn-full" onclick="addManualSchedule()">Add Schedule</button>
                    <div class="schedule-list" id="manualScheduleList"></div>
                </div>
            </div>
        </div>

        <!-- AUTO MODE -->
        <div class="mode-content" id="autoMode">
            <div class="card">
                <h2 class="card-title">ü§ñ Auto Schedule Generator</h2>
                <div id="subjectsContainer">
                    <div class="subject-block">
                        <div class="subject-header">
                            <h3>Subject 1</h3>
                            <button class="remove-subject" onclick="removeSubjectBlock(this)">Remove Subject</button>
                        </div>
                        <div class="input-group">
                            <label>Subject Name</label>
                            <input type="text" class="subject-name" placeholder="e.g., Physics">
                        </div>
                        <div id="chaptersContainer1" class="chapters-container">
                            <div class="chapter-row">
                                <input type="text" placeholder="Chapter name" class="chapter-name">
                                <input type="number" placeholder="Minutes" class="chapter-time" min="1">
                                <button class="remove-chapter" onclick="removeChapterRow(this)">√ó</button>
                            </div>
                        </div>
                        <button class="btn btn-success" onclick="addChapterRow(this)">+ Add Chapter</button>
                    </div>
                </div>
                <button class="btn btn-warning btn-full" onclick="addSubjectBlock()" style="margin-bottom: 2rem;">+ Add Another Subject</button>
                
                <div class="time-inputs">
                    <div class="input-group">
                        <label>Start Time</label>
                        <input type="time" id="autoStartTime">
                    </div>
                    <div class="input-group">
                        <label>Include 10 min break after each session?</label>
                        <select id="includeBreak">
                            <option value="yes">Yes</option>
                            <option value="no">No</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn btn-primary btn-full" onclick="generateAutoSchedule()">Generate Schedule</button>
                <div class="schedule-list" id="autoScheduleList"></div>
            </div>
        </div>

        <!-- POMODORO MODE -->
        <div class="mode-content" id="pomoMode">
            <div class="card">
                <h2 class="card-title">‚è±Ô∏è Pomodoro Timer</h2>
                <div class="pomo-inputs">
                    <div class="pomo-input">
                        <label>Hours</label>
                        <input type="number" id="pomoHours" min="0" max="23" value="0">
                    </div>
                    <div class="pomo-input">
                        <label>Minutes</label>
                        <input type="number" id="pomoMinutes" min="0" max="59" value="25">
                    </div>
                    <div class="pomo-input">
                        <label>Seconds</label>
                        <input type="number" id="pomoSeconds" min="0" max="59" value="0">
                    </div>
                </div>
                <div class="pomo-display" id="pomoDisplay">00:25:00</div>
                <button class="btn btn-primary btn-full" id="pomoBtn" onclick="togglePomo()">START TIMER</button>
            </div>
        </div>

        <!-- REPORT MODE -->
        <div class="mode-content" id="reportMode">
            <div class="card">
                <h2 class="card-title">üìä Study Report</h2>
                <div id="reportContent"></div>
                <button class="btn btn-success report-download-btn" onclick="downloadReportAsPDF()">
                    üì• Download Report as PDF
                </button>
            </div>
        </div>
    </div>

    <script>
        let manualSchedules = [];
        let autoSchedules = [];
        let studyReport = [];
        let activeSession = null;
        let alarmInterval = null;
        let alarmSound = null;
        let pomoInterval = null;
        let pomoRunning = false;
        let pomoTime = 1500;
        let currentMode = 'manual';
        let breakSessions = [];
        let subjectCounter = 1;
        const bc = new BroadcastChannel('frz_timer');
        
        function createAlarmSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'square';
            gainNode.gain.value = 0.3;
            
            return { audioContext, oscillator, gainNode };
        }

        function createParticles() {
            const container = document.getElementById('particles');
            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                container.appendChild(particle);
            }
        }

        function updateClock() {
            const now = new Date();
            let hours = now.getHours();
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12 || 12;
            
            const timeStr = `${hours}:${pad(minutes)}:${pad(seconds)}`;
            document.getElementById('clockTime').textContent = timeStr;
            document.getElementById('clockAMPM').textContent = ampm;
        }

        function pad(n) {
            return n.toString().padStart(2, '0');
        }

        function switchMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.mode-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(mode + 'Mode').classList.add('active');
            
            if (mode === 'report') {
                generateReport();
            }
        }

        // MANUAL MODE
        function addManualSchedule() {
            const subject = document.getElementById('subjectName').value.trim();
            const start = document.getElementById('startTime').value;
            const end = document.getElementById('endTime').value;

            if (!subject || !start || !end) {
                alert('Please fill all fields');
                return;
            }

            const schedule = {
                id: Date.now(),
                subject,
                chapter: null,
                start,
                end,
                active: false,
                completed: false,
                mode: 'manual',
                startedAt: null,
                completedAt: null,
                extraTime: 0
            };

            manualSchedules.push(schedule);
            saveData();
            renderManualSchedules();
            
            document.getElementById('subjectName').value = '';
            document.getElementById('startTime').value = '';
            document.getElementById('endTime').value = '';
        }

        function deleteManualSchedule(id) {
            manualSchedules = manualSchedules.filter(s => s.id !== id);
            saveData();
            renderManualSchedules();
        }

        function renderManualSchedules() {
            const list = document.getElementById('manualScheduleList');
            list.innerHTML = manualSchedules.map(s => `
                <div class="schedule-item ${s.active ? 'active' : ''} ${s.completed ? 'completed' : ''}">
                    <span>${s.subject} ${formatTime(s.start)} ‚Üí ${formatTime(s.end)}</span>
                    <button class="delete-btn" onclick="deleteManualSchedule(${s.id})">√ó</button>
                </div>
            `).join('');
        }

        // AUTO MODE - MULTIPLE SUBJECTS
        function addSubjectBlock() {
            subjectCounter++;
            const subjectsContainer = document.getElementById('subjectsContainer');
            const subjectBlock = document.createElement('div');
            subjectBlock.className = 'subject-block';
            subjectBlock.innerHTML = `
                <div class="subject-header">
                    <h3>Subject ${subjectCounter}</h3>
                    <button class="remove-subject" onclick="removeSubjectBlock(this)">Remove Subject</button>
                </div>
                <div class="input-group">
                    <label>Subject Name</label>
                    <input type="text" class="subject-name" placeholder="e.g., Mathematics">
                </div>
                <div id="chaptersContainer${subjectCounter}" class="chapters-container">
                    <div class="chapter-row">
                        <input type="text" placeholder="Chapter name" class="chapter-name">
                        <input type="number" placeholder="Minutes" class="chapter-time" min="1">
                        <button class="remove-chapter" onclick="removeChapterRow(this)">√ó</button>
                    </div>
                </div>
                <button class="btn btn-success" onclick="addChapterRow(this)">+ Add Chapter</button>
            `;
            subjectsContainer.appendChild(subjectBlock);
        }

        function removeSubjectBlock(btn) {
            const subjectBlock = btn.closest('.subject-block');
            if (document.querySelectorAll('.subject-block').length > 1) {
                subjectBlock.remove();
            } else {
                alert('At least one subject is required');
            }
        }

        function addChapterRow(btn) {
            const subjectBlock = btn.closest('.subject-block');
            const chaptersContainer = subjectBlock.querySelector('.chapters-container');
            const row = document.createElement('div');
            row.className = 'chapter-row';
            row.innerHTML = `
                <input type="text" placeholder="Chapter name" class="chapter-name">
                <input type="number" placeholder="Minutes" class="chapter-time" min="1">
                <button class="remove-chapter" onclick="removeChapterRow(this)">√ó</button>
            `;
            chaptersContainer.appendChild(row);
        }

        function removeChapterRow(btn) {
            btn.parentElement.remove();
        }

        function generateAutoSchedule() {
            const startTime = document.getElementById('autoStartTime').value;
            const includeBreak = document.getElementById('includeBreak').value === 'yes';
            
            if (!startTime) {
                alert('Please enter start time');
                return;
            }

            const subjectBlocks = document.querySelectorAll('.subject-block');
            if (subjectBlocks.length === 0) {
                alert('Please add at least one subject');
                return;
            }

            autoSchedules = [];
            breakSessions = [];
            let currentTime = startTime;
            let scheduleId = 1;

            subjectBlocks.forEach((subjectBlock, subjectIndex) => {
                const subjectName = subjectBlock.querySelector('.subject-name').value.trim();
                if (!subjectName) {
                    alert(`Please enter name for Subject ${subjectIndex + 1}`);
                    return;
                }

                const chapterRows = subjectBlock.querySelectorAll('.chapter-row');
                const chapters = [];
                
                chapterRows.forEach(row => {
                    const name = row.querySelector('.chapter-name').value.trim();
                    const time = parseInt(row.querySelector('.chapter-time').value);
                    if (name && time > 0) {
                        chapters.push({ name, time });
                    }
                });

                if (chapters.length === 0) {
                    alert(`Please add at least one chapter for ${subjectName}`);
                    return;
                }

                chapters.forEach((chapter, chapterIndex) => {
                    const [hours, minutes] = currentTime.split(':').map(Number);
                    const startDate = new Date();
                    startDate.setHours(hours, minutes, 0);
                    
                    const endDate = new Date(startDate.getTime() + chapter.time * 60000);
                    const endTime = `${pad(endDate.getHours())}:${pad(endDate.getMinutes())}`;
                    
                    const schedule = {
                        id: scheduleId++,
                        subject: subjectName,
                        chapter: chapter.name,
                        start: currentTime,
                        end: endTime,
                        duration: chapter.time,
                        active: false,
                        completed: false,
                        mode: 'auto',
                        startedAt: null,
                        completedAt: null,
                        extraTime: 0,
                        isBreak: false
                    };
                    
                    autoSchedules.push(schedule);
                    currentTime = endTime;

                    // Add break after each session except the last one
                    if (includeBreak && !(subjectIndex === subjectBlocks.length - 1 && chapterIndex === chapters.length - 1)) {
                        const breakStartDate = new Date();
                        breakStartDate.setHours(parseInt(currentTime.split(':')[0]), parseInt(currentTime.split(':')[1]), 0);
                        
                        const breakEndDate = new Date(breakStartDate.getTime() + 10 * 60000);
                        const breakEndTime = `${pad(breakEndDate.getHours())}:${pad(breakEndDate.getMinutes())}`;
                        
                        const breakSchedule = {
                            id: scheduleId++,
                            subject: "BREAK",
                            chapter: "10 Minute Break",
                            start: currentTime,
                            end: breakEndTime,
                            duration: 10,
                            active: false,
                            completed: false,
                            mode: 'auto',
                            startedAt: null,
                            completedAt: null,
                            extraTime: 0,
                            isBreak: true
                        };
                        
                        breakSessions.push(breakSchedule);
                        autoSchedules.push(breakSchedule);
                        currentTime = breakEndTime;
                    }
                });
            });

            saveData();
            renderAutoSchedules();
            
            document.getElementById('autoStartTime').value = '';
        }

        function deleteAutoSchedule(id) {
            autoSchedules = autoSchedules.filter(s => s.id !== id);
            breakSessions = breakSessions.filter(s => s.id !== id);
            saveData();
            renderAutoSchedules();
        }

        function renderAutoSchedules() {
            const list = document.getElementById('autoScheduleList');
            list.innerHTML = autoSchedules.map(s => `
                <div class="schedule-item ${s.active ? 'active' : ''} ${s.completed ? 'completed' : ''} ${s.isBreak ? 'break' : ''}">
                    <span>${s.isBreak ? '‚è∏Ô∏è ' : 'üìö '}${s.subject} ${s.chapter ? '- ' + s.chapter : ''} ${s.duration ? '(' + s.duration + 'min)' : ''} ${formatTime(s.start)} ‚Üí ${formatTime(s.end)}</span>
                    <button class="delete-btn" onclick="deleteAutoSchedule(${s.id})">√ó</button>
                </div>
            `).join('');
        }

        function formatTime(time24) {
            const [h, m] = time24.split(':');
            const hour = parseInt(h);
            const ampm = hour >= 12 ? 'PM' : 'AM';
            const hour12 = hour % 12 || 12;
            return `${hour12}:${pad(m)}${ampm}`;
        }

        function checkAlarms() {
            const now = new Date();
            const currentTime = `${pad(now.getHours())}:${pad(now.getMinutes())}`;

            // Check manual schedules
            manualSchedules.forEach(schedule => {
                if (schedule.completed) return;

                if (currentTime === schedule.start && !schedule.active) {
                    triggerStartAlarm(schedule);
                } else if (currentTime === schedule.end && schedule.active) {
                    triggerEndAlarm(schedule);
                }
            });

            // Check auto schedules including breaks
            autoSchedules.forEach(schedule => {
                if (schedule.completed) return;

                if (currentTime === schedule.start && !schedule.active) {
                    if (schedule.isBreak) {
                        triggerBreakAlarm(schedule);
                    } else {
                        triggerStartAlarm(schedule);
                    }
                } else if (currentTime === schedule.end && schedule.active) {
                    if (schedule.isBreak) {
                        schedule.completed = true;
                        schedule.completedAt = new Date().toISOString();
                        saveData();
                        renderAutoSchedules();
                    } else {
                        askCompletion(schedule);
                    }
                }
            });
        }

        function triggerBreakAlarm(schedule) {
            schedule.active = true;
            schedule.startedAt = new Date().toISOString();
            saveData();
            renderAutoSchedules();

            const overlay = document.getElementById('alarmOverlay');
            overlay.className = 'alarm-overlay break';
            overlay.style.display = 'flex';
            
            document.getElementById('alarmMessage').textContent = `‚è∏Ô∏è TIME FOR A BREAK!`;
            document.getElementById('alarmButtons').innerHTML = `
                <button class="alarm-btn break-btn" onclick="startBreak()">START BREAK</button>
                <button class="alarm-btn snooze-btn" onclick="skipBreak(${schedule.id})">SKIP BREAK</button>
            `;
            
            document.getElementById('giantClock').classList.add('clock-buzz');
            document.getElementById('warningLight').classList.add('active');

            playAlarmSound();
            speakMessage("Time for a break! Take 10 minutes to relax.");

            alarmInterval = setInterval(() => {
                playAlarmSound();
                speakMessage("Break time! Relax for 10 minutes.");
            }, 5000);
        }

        function startBreak() {
            stopAlarmSound();
            clearInterval(alarmInterval);
            document.getElementById('alarmOverlay').style.display = 'none';
            document.getElementById('giantClock').classList.remove('clock-buzz');
            document.getElementById('warningLight').classList.remove('active');
            speechSynthesis.cancel();
        }

        function skipBreak(breakId) {
            const breakSchedule = autoSchedules.find(s => s.id === breakId);
            if (breakSchedule) {
                breakSchedule.completed = true;
                breakSchedule.completedAt = new Date().toISOString();
                saveData();
                renderAutoSchedules();
            }
            startBreak();
        }

        function triggerStartAlarm(schedule) {
            activeSession = schedule;
            schedule.active = true;
            schedule.startedAt = new Date().toISOString();
            saveData();
            renderManualSchedules();
            renderAutoSchedules();

            const overlay = document.getElementById('alarmOverlay');
            overlay.className = 'alarm-overlay red';
            overlay.style.display = 'flex';
            
            const chapterText = schedule.chapter ? ` - ${schedule.chapter}` : '';
            document.getElementById('alarmMessage').textContent = `STUDY ${schedule.subject.toUpperCase()}${chapterText} NOW!`;
            document.getElementById('alarmButtons').innerHTML = `
                <button class="alarm-btn start-btn" onclick="startStudying()">START STUDYING</button>
                <button class="alarm-btn snooze-btn" onclick="snoozeAlarm()">SNOOZE 5 MIN</button>
            `;
            
            document.getElementById('giantClock').classList.add('clock-buzz');
            document.getElementById('warningLight').classList.add('active');

            playAlarmSound();
            speakMessage(`Study ${schedule.subject}${schedule.chapter ? ' ' + schedule.chapter : ''} now!`);

            alarmInterval = setInterval(() => {
                playAlarmSound();
                speakMessage(`Study ${schedule.subject}${schedule.chapter ? ' ' + schedule.chapter : ''} now!`);
            }, 5000);
        }

        function triggerEndAlarm(schedule) {
            schedule.active = false;
            schedule.completed = true;
            schedule.completedAt = new Date().toISOString();
            
            // Add to report with detailed information
            studyReport.push({
                subject: schedule.subject,
                chapter: schedule.chapter,
                startedAt: schedule.startedAt,
                completedAt: schedule.completedAt,
                duration: calculateDuration(schedule.startedAt, schedule.completedAt),
                scheduledStart: schedule.start,
                scheduledEnd: schedule.end,
                extraTime: schedule.extraTime,
                breakTaken: false
            });
            
            activeSession = null;
            saveData();
            renderManualSchedules();

            const overlay = document.getElementById('alarmOverlay');
            overlay.className = 'alarm-overlay green';
            overlay.style.display = 'flex';

            const nextSchedule = manualSchedules.find(s => !s.completed && s.start > schedule.end);
            const nextMsg = nextSchedule ? ` Next is ${nextSchedule.subject} at ${formatTime(nextSchedule.start)}` : '';
            
            const chapterText = schedule.chapter ? ` - ${schedule.chapter}` : '';
            document.getElementById('alarmMessage').textContent = `You completed ${schedule.subject}${chapterText} successfully!${nextMsg}`;
            document.getElementById('alarmButtons').innerHTML = '';
            document.getElementById('warningLight').classList.remove('active');

            speakMessage(`You completed ${schedule.subject}${schedule.chapter ? ' ' + schedule.chapter : ''} successfully!${nextMsg}`, true);

            setTimeout(() => {
                overlay.style.display = 'none';
            }, 5000);
        }

        function askCompletion(schedule) {
            activeSession = schedule;
            stopAlarmSound();
            clearInterval(alarmInterval);

            const overlay = document.getElementById('alarmOverlay');
            overlay.className = 'alarm-overlay question';
            overlay.style.display = 'flex';
            
            const chapterText = schedule.chapter ? ` - ${schedule.chapter}` : '';
            document.getElementById('alarmMessage').textContent = `Is ${schedule.subject}${chapterText} complete?`;
            document.getElementById('alarmButtons').innerHTML = `
                <button class="alarm-btn yes-btn" onclick="completeSession(true)">YES, COMPLETED</button>
                <button class="alarm-btn no-btn" onclick="completeSession(false)">NO, NEED MORE TIME</button>
            `;
            
            speakMessage(`Is ${schedule.subject}${schedule.chapter ? ' ' + schedule.chapter : ''} complete?`);
        }

        function completeSession(isComplete) {
            if (isComplete) {
                activeSession.completed = true;
                activeSession.completedAt = new Date().toISOString();
                activeSession.active = false;
                
                // Check if there was a break after this session
                const nextSchedule = autoSchedules.find(s => s.start === activeSession.end && s.isBreak);
                const breakTaken = nextSchedule ? nextSchedule.completed : false;
                
                // Add to report with detailed information
                studyReport.push({
                    subject: activeSession.subject,
                    chapter: activeSession.chapter,
                    startedAt: activeSession.startedAt,
                    completedAt: activeSession.completedAt,
                    duration: calculateDuration(activeSession.startedAt, activeSession.completedAt),
                    scheduledStart: activeSession.start,
                    scheduledEnd: activeSession.end,
                    extraTime: activeSession.extraTime,
                    breakTaken: breakTaken
                });
                
                saveData();
                renderAutoSchedules();
                
                const overlay = document.getElementById('alarmOverlay');
                overlay.className = 'alarm-overlay green';
                
                const nextStudySchedule = autoSchedules.find(s => !s.completed && s.start > activeSession.end && !s.isBreak);
                const nextMsg = nextStudySchedule ? ` Next is ${nextStudySchedule.subject} - ${nextStudySchedule.chapter} at ${formatTime(nextStudySchedule.start)}` : '';
                
                document.getElementById('alarmMessage').textContent = `Great job completing ${activeSession.subject}!${nextMsg}`;
                document.getElementById('alarmButtons').innerHTML = '';
                
                speakMessage(`Great job completing ${activeSession.subject}!${nextMsg}`, true);
                
                activeSession = null;
                
                setTimeout(() => {
                    overlay.style.display = 'none';
                }, 5000);
            } else {
                document.getElementById('alarmMessage').textContent = `How many more minutes do you need?`;
                document.getElementById('alarmButtons').innerHTML = '';
                document.getElementById('extendInput').style.display = 'block';
            }
        }

        function confirmExtend() {
            const extraMinutes = parseInt(document.getElementById('extendMinutes').value);
            if (!extraMinutes || extraMinutes < 1) {
                alert('Please enter valid minutes');
                return;
            }

            // Add extra time to current session
            activeSession.extraTime += extraMinutes;
            
            // Extend current session end time
            const [hours, minutes] = activeSession.end.split(':').map(Number);
            const endDate = new Date();
            endDate.setHours(hours, minutes + extraMinutes, 0);
            activeSession.end = `${pad(endDate.getHours())}:${pad(endDate.getMinutes())}`;
            activeSession.duration += extraMinutes;

            // Adjust all following sessions
            const currentIndex = autoSchedules.findIndex(s => s.id === activeSession.id);
            for (let i = currentIndex + 1; i < autoSchedules.length; i++) {
                const schedule = autoSchedules[i];
                const [startH, startM] = schedule.start.split(':').map(Number);
                const [endH, endM] = schedule.end.split(':').map(Number);
                
                const newStart = new Date();
                newStart.setHours(startH, startM + extraMinutes, 0);
                schedule.start = `${pad(newStart.getHours())}:${pad(newStart.getMinutes())}`;
                
                const newEnd = new Date();
                newEnd.setHours(endH, endM + extraMinutes, 0);
                schedule.end = `${pad(newEnd.getHours())}:${pad(newEnd.getMinutes())}`;
            }

            saveData();
            renderAutoSchedules();
            
            document.getElementById('alarmOverlay').style.display = 'none';
            document.getElementById('extendInput').style.display = 'none';
            document.getElementById('extendMinutes').value = '';
            
            activeSession.active = true;
            speakMessage(`Extended ${activeSession.subject} by ${extraMinutes} minutes`, true);
        }

        function calculateDuration(start, end) {
            const startTime = new Date(start);
            const endTime = new Date(end);
            const diff = endTime - startTime;
            const minutes = Math.floor(diff / 60000);
            return minutes;
        }

        function playAlarmSound() {
            if (!alarmSound) {
                alarmSound = createAlarmSound();
                alarmSound.oscillator.start();
                
                setInterval(() => {
                    if (alarmSound && alarmSound.oscillator) {
                        alarmSound.oscillator.frequency.value = 
                            alarmSound.oscillator.frequency.value === 800 ? 1000 : 800;
                    }
                }, 300);
            }
        }

        function stopAlarmSound() {
            if (alarmSound) {
                try {
                    alarmSound.oscillator.stop();
                    alarmSound.audioContext.close();
                } catch (e) {
                    console.log('Audio already stopped');
                }
                alarmSound = null;
            }
        }

        function speakMessage(text, sweet = false) {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.rate = sweet ? 0.9 : 1.2;
                utterance.pitch = sweet ? 1.2 : 1;
                utterance.volume = 1;
                speechSynthesis.speak(utterance);
            }
        }

        function startStudying() {
            stopAlarmSound();
            clearInterval(alarmInterval);
            document.getElementById('alarmOverlay').style.display = 'none';
            document.getElementById('giantClock').classList.remove('clock-buzz');
            speechSynthesis.cancel();
        }

        function snoozeAlarm() {
            if (activeSession) {
                const [h, m] = activeSession.start.split(':');
                const newTime = new Date();
                newTime.setHours(parseInt(h), parseInt(m) + 5);
                activeSession.start = `${pad(newTime.getHours())}:${pad(newTime.getMinutes())}`;
                activeSession.active = false;
                activeSession = null;
                saveData();
                renderManualSchedules();
                renderAutoSchedules();
            }
            startStudying();
        }

        // POMODORO
        function togglePomo() {
            if (pomoRunning) {
                clearInterval(pomoInterval);
                pomoRunning = false;
                document.getElementById('pomoBtn').textContent = 'START TIMER';
                document.getElementById('pomoBtn').className = 'btn btn-primary btn-full';
            } else {
                const h = parseInt(document.getElementById('pomoHours').value) || 0;
                const m = parseInt(document.getElementById('pomoMinutes').value) || 0;
                const s = parseInt(document.getElementById('pomoSeconds').value) || 0;
                pomoTime = h * 3600 + m * 60 + s;
                
                if (pomoTime <= 0) {
                    alert('Please set a valid time');
                    return;
                }

                pomoRunning = true;
                document.getElementById('pomoBtn').textContent = 'STOP TIMER';
                document.getElementById('pomoBtn').className = 'btn btn-danger btn-full';
                
                pomoInterval = setInterval(() => {
                    if (pomoTime <= 0) {
                        clearInterval(pomoInterval);
                        pomoRunning = false;
                        document.getElementById('pomoBtn').textContent = 'START TIMER';
                        document.getElementById('pomoBtn').className = 'btn btn-primary btn-full';
                        
                        const pomoAlarm = createAlarmSound();
                        pomoAlarm.oscillator.start();
                        speakMessage('Pomodoro session completed!', true);
                        setTimeout(() => {
                            pomoAlarm.oscillator.stop();
                            pomoAlarm.audioContext.close();
                        }, 5000);
                        return;
                    }
                    pomoTime--;
                    updatePomoDisplay();
                }, 1000);
            }
        }

        function updatePomoDisplay() {
            const h = Math.floor(pomoTime / 3600);
            const m = Math.floor((pomoTime % 3600) / 60);
            const s = pomoTime % 60;
            document.getElementById('pomoDisplay').textContent = `${pad(h)}:${pad(m)}:${pad(s)}`;
        }

        // REPORT GENERATION
        function generateReport() {
            const reportContent = document.getElementById('reportContent');
            
            if (studyReport.length === 0) {
                reportContent.innerHTML = '<p style="color: white; text-align: center; padding: 2rem;">No study sessions completed yet. Start studying to see your report!</p>';
                return;
            }

            let totalMinutes = 0;
            let totalExtraTime = 0;
            let html = '<div class="report-card">';
            
            html += `
                <div class="report-header">
                    <h2>FRZ STUDY MASTER REPORT</h2>
                    <div class="subtitle">Detailed Study Session Analysis</div>
                </div>
            `;
            
            studyReport.forEach((item, index) => {
                const chapterText = item.chapter ? `the "${item.chapter}" chapter of the subject "${item.subject}"` : `the subject "${item.subject}"`;
                const scheduledStartTime = formatTime(item.scheduledStart);
                const scheduledEndTime = formatTime(item.scheduledEnd);
                const actualStartTime = new Date(item.startedAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const actualEndTime = new Date(item.completedAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                html += `
                    <div class="session-details">
                        <div class="session-info">
                            <div class="info-item">
                                <div class="info-label">Session ${index + 1}</div>
                                <div class="info-value">${item.subject}${item.chapter ? ' - ' + item.chapter : ''}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Scheduled Time</div>
                                <div class="info-value">${scheduledStartTime} to ${scheduledEndTime}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Actual Time</div>
                                <div class="info-value">${actualStartTime} to ${actualEndTime}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label">Duration</div>
                                <div class="info-value">${item.duration} minutes</div>
                            </div>
                        </div>
                        
                        <div class="report-message">
                            ${chapterText} that was scheduled from ${scheduledStartTime} to ${scheduledEndTime} has been ended successfully. It took ${item.duration} minutes to complete. ${item.extraTime > 0 ? `Extra ${item.extraTime} minutes were added to complete it.` : 'No extra time was needed.'} ${item.breakTaken ? 'A 10-minute break was taken after this session.' : 'No break was taken after this session.'}
                        </div>
                        
                        ${item.extraTime > 0 ? `
                            <div class="extra-time">
                                ‚ö†Ô∏è Extra time taken: ${item.extraTime} minutes
                            </div>
                        ` : ''}
                        
                        ${item.breakTaken ? `
                            <div class="break-info">
                                ‚è∏Ô∏è 10-minute break was included
                            </div>
                        ` : ''}
                    </div>
                `;
                totalMinutes += item.duration;
                totalExtraTime += item.extraTime;
            });

            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            
            html += `
                <div class="report-total">
                    <div>üìä TOTAL STUDY TIME: ${hours}h ${minutes}m</div>
                    ${totalExtraTime > 0 ? `<div style="color: #ef4444; margin-top: 0.5rem;">‚è±Ô∏è TOTAL EXTRA TIME: ${totalExtraTime} minutes</div>` : ''}
                </div>
                
                <div class="report-footer">
                    FRZ AUTO GENERATED REPORT
                </div>
            </div>`;
            
            reportContent.innerHTML = html;
        }

        // PDF DOWNLOAD FUNCTION
        async function downloadReportAsPDF() {
            if (studyReport.length === 0) {
                alert('No report data available to download');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add FRZ logo/text at top
            doc.setFontSize(24);
            doc.setTextColor(59, 130, 246);
            doc.text("FRZ STUDY MASTER", 105, 20, { align: 'center' });
            
            doc.setFontSize(16);
            doc.setTextColor(100, 100, 100);
            doc.text("Detailed Study Report", 105, 30, { align: 'center' });
            
            doc.setFontSize(10);
            doc.setTextColor(150, 150, 150);
            doc.text(`Generated on ${new Date().toLocaleDateString()} at ${new Date().toLocaleTimeString()}`, 105, 38, { align: 'center' });
            
            let yPosition = 50;
            
            studyReport.forEach((item, index) => {
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                const chapterText = item.chapter ? `the "${item.chapter}" chapter of the subject "${item.subject}"` : `the subject "${item.subject}"`;
                const scheduledStartTime = formatTime(item.scheduledStart);
                const scheduledEndTime = formatTime(item.scheduledEnd);
                const actualStartTime = new Date(item.startedAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const actualEndTime = new Date(item.completedAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                doc.setFontSize(12);
                doc.setTextColor(0, 0, 0);
                doc.setFont(undefined, 'bold');
                doc.text(`Session ${index + 1}: ${item.subject}${item.chapter ? ' - ' + item.chapter : ''}`, 20, yPosition);
                doc.setFont(undefined, 'normal');
                
                yPosition += 8;
                doc.setFontSize(10);
                doc.text(`Scheduled: ${scheduledStartTime} to ${scheduledEndTime}`, 20, yPosition);
                yPosition += 6;
                doc.text(`Actual: ${actualStartTime} to ${actualEndTime}`, 20, yPosition);
                yPosition += 6;
                doc.text(`Duration: ${item.duration} minutes`, 20, yPosition);
                
                yPosition += 8;
                doc.setFontSize(9);
                doc.setTextColor(80, 80, 80);
                const reportLine = `${chapterText} that was scheduled from ${scheduledStartTime} to ${scheduledEndTime} has been ended successfully. It took ${item.duration} minutes to complete.`;
                const splitReport = doc.splitTextToSize(reportLine, 170);
                doc.text(splitReport, 20, yPosition);
                yPosition += splitReport.length * 5;
                
                if (item.extraTime > 0) {
                    doc.setTextColor(220, 38, 38);
                    doc.text(`Extra time taken: ${item.extraTime} minutes`, 20, yPosition);
                    yPosition += 6;
                }
                
                if (item.breakTaken) {
                    doc.setTextColor(245, 158, 11);
                    doc.text(`10-minute break was included`, 20, yPosition);
                    yPosition += 6;
                }
                
                yPosition += 10;
                doc.setDrawColor(200, 200, 200);
                doc.line(20, yPosition, 190, yPosition);
                yPosition += 5;
            });
            
            // Add totals
            const totalMinutes = studyReport.reduce((sum, item) => sum + item.duration, 0);
            const totalExtraTime = studyReport.reduce((sum, item) => sum + item.extraTime, 0);
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            
            yPosition += 5;
            doc.setFontSize(14);
            doc.setTextColor(59, 130, 246);
            doc.setFont(undefined, 'bold');
            doc.text(`TOTAL STUDY TIME: ${hours}h ${minutes}m`, 20, yPosition);
            
            if (totalExtraTime > 0) {
                yPosition += 8;
                doc.setTextColor(220, 38, 38);
                doc.text(`TOTAL EXTRA TIME: ${totalExtraTime} minutes`, 20, yPosition);
            }
            
            yPosition += 15;
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text("FRZ AUTO GENERATED REPORT", 105, yPosition, { align: 'center' });
            
            // Save the PDF
            doc.save(`FRZ_Study_Report_${new Date().toISOString().slice(0, 10)}.pdf`);
        }

        function saveData() {
            localStorage.setItem('frz_manual', JSON.stringify(manualSchedules));
            localStorage.setItem('frz_auto', JSON.stringify(autoSchedules));
            localStorage.setItem('frz_report', JSON.stringify(studyReport));
            localStorage.setItem('frz_breaks', JSON.stringify(breakSessions));
            bc.postMessage({ type: 'update' });
        }

        function loadData() {
            const manual = localStorage.getItem('frz_manual');
            const auto = localStorage.getItem('frz_auto');
            const report = localStorage.getItem('frz_report');
            const breaks = localStorage.getItem('frz_breaks');
            
            if (manual) manualSchedules = JSON.parse(manual);
            if (auto) autoSchedules = JSON.parse(auto);
            if (report) studyReport = JSON.parse(report);
            if (breaks) breakSessions = JSON.parse(breaks);
            
            renderManualSchedules();
            renderAutoSchedules();
        }

        bc.onmessage = () => {
            loadData();
        };

        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                startStudying();
            }
        });

        createParticles();
        loadData();
        updateClock();
        setInterval(updateClock, 1000);
        setInterval(checkAlarms, 1000);
    </script>
</body>
</html>
